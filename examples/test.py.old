#!/usr/bin/python3

import json, os, requests

from config import load_config
from swgohgg import get_gear_list
from swgohhelp import fetch_players

gear = {}

config = load_config()
ally_codes = [ '358697456' ]
all_gear = get_gear_list()
players = fetch_players(config, ally_codes)
for ally_code, data in players.items():
	for base_id, unit in data['roster'].items():
		if base_id not in gear:
			gear[base_id] = {}
		equipped = unit['equipped']
		for gear_item in equipped:
			gear_id = gear_item['equipmentId']
			ref = all_gear[gear_id]
			slot = 'slot%s' % gear_item['slot']
			gear[base_id][slot] = '%s %s' % (ref['name'], ref['image'])

for base_id, gear_info in gear.items():
	print('%s' % base_id)
	for slot, data in sorted(gear_info.items()):
		print('%s: %s' % (slot, data))
"""
for gear_id, gear in all_gear.items():
	url = gear['image'].replace('//', 'https://', 1)
	print('Fetching %s' % url)
	response = requests.get(url)
	if response.status_code == 200:
		basename = os.path.basename(url)
		save_path = 'django/images/assets/%s' % basename
		with open(save_path, 'wb') as fout:
			for chunk in response:
				fout.write(chunk)
	else:
		print('ERROR: Failed fetching %s' % url)
"""
